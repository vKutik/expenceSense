"""
–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
"""
import requests
import time

BOT_TOKEN = "8319629279:AAERWVdXipQIoqZR_OPd6RtcFHEb2PNvMG4"

def send_start_message(chat_id):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π Mini App"""
    
    keyboard = {
        "inline_keyboard": [
            [
                {
                    "text": "üì± Open Expense Tracker",
                    "web_app": {
                        "url": "https://snake-gcaeog0dh-volodymyr-s-projects-9f0184a4.vercel.app"
                    }
                }
            ]
        ]
    }
    
    message = f"""
üëã *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Expense Tracker!*

üí∞ –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ —Ä–∞—Å—Ö–æ–¥—ã —Å –ª–µ–≥–∫–æ—Å—Ç—å—é
üìä –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É  
üéØ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –±—é–¥–∂–µ—Ç–∞–º–∏
üì± –î–æ—Å—Ç—É–ø —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

*–§—É–Ω–∫—Ü–∏–∏:*
‚Ä¢ üè∑Ô∏è –£–º–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
‚Ä¢ üìà –í–∏–∑—É–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚Ä¢ üí≥ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
‚Ä¢ üîí –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚Ä¢ ‚òÅÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ –æ–±–ª–∞–∫–µ (Premium)

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
"""
    
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
    data = {
        'chat_id': chat_id,
        'text': message,
        'parse_mode': 'Markdown',
        'reply_markup': keyboard
    }
    
    response = requests.post(url, json=data)
    return response.json()

def send_help_message(chat_id):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é"""
    
    message = """
*–ö–æ–º–∞–Ω–¥—ã Expense Tracker Bot:*

/start - –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–º–æ—â–∏
/about - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

*–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*
1. –ù–∞–∂–º–∏—Ç–µ "üì± Open Expense Tracker" –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –í–∞—à –∞–∫–∫–∞—É–Ω—Ç Telegram –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
3. –°—Ä–∞–∑—É –Ω–∞—á–Ω–∏—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ–∏ —Ä–∞—Å—Ö–æ–¥—ã!

*–£—Ä–æ–≤–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:*
üë§ –ì–æ—Å—Ç—å - –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏
üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π - –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  
‚≠ê –ü—Ä–µ–º–∏—É–º - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
üëë –ê–¥–º–∏–Ω - –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

*–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?* –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
"""
    
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
    data = {
        'chat_id': chat_id,
        'text': message,
        'parse_mode': 'Markdown'
    }
    
    response = requests.post(url, json=data)
    return response.json()

def send_about_message(chat_id):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏"""
    
    message = """
*Expense Tracker v1.2*

üéØ *–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:* –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ —Å —á–∏—Å—Ç—ã–º –¥–∏–∑–∞–π–Ω–æ–º
üèóÔ∏è *–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:* –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
üîê *–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:* –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
üì± *–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:* Telegram Mini App

*–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:*
‚Ä¢ Flask backend —Å —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
‚Ä¢ –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (–ü–∞–º—è—Ç—å, –§–∞–π–ª, –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –û–±–ª–∞–∫–æ)
‚Ä¢ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–∫–µ–Ω–æ–≤
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è
‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

*–í–∞—Ä–∏–∞–Ω—Ç—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è:*
‚Ä¢ üíæ –ü–∞–º—è—Ç—å - –ë—ã—Å—Ç—Ä–æ–µ, —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Å—Å–∏–∏
‚Ä¢ üìÅ –§–∞–π–ª - –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ—Å—Ç—å
‚Ä¢ üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
‚Ä¢ ‚òÅÔ∏è –û–±–ª–∞–∫–æ - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

*–°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é:* Python, Flask, SQLite, HTML5, CSS3

*–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:* –í–∞—à–µ –∏–º—è
*–í–µ—Ä—Å–∏—è:* 1.2.0
*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:* –û–∫—Ç—è–±—Ä—å 2024
"""
    
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
    data = {
        'chat_id': chat_id,
        'text': message,
        'parse_mode': 'Markdown'
    }
    
    response = requests.post(url, json=data)
    return response.json()

def get_updates():
    """–ü–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram"""
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/getUpdates"
    response = requests.get(url)
    return response.json()

def process_updates():
    """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
    print("üîÑ –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...")
    
    updates = get_updates()
    
    if not updates.get('ok'):
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: {updates}")
        return
    
    update_list = updates.get('result', [])
    print(f"üì® –ü–æ–ª—É—á–µ–Ω–æ {len(update_list)} –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π")
    
    for update in update_list:
        message = update.get('message', {})
        if not message:
            continue
            
        chat_id = message.get('chat', {}).get('id')
        text = message.get('text', '')
        
        print(f"üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {chat_id}: {text}")
        
        # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã
        if text == '/start':
            result = send_start_message(chat_id)
            print(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: {result.get('ok', False)}")
            
        elif text == '/help':
            result = send_help_message(chat_id)
            print(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–º–æ—â–∏: {result.get('ok', False)}")
            
        elif text == '/about':
            result = send_about_message(chat_id)
            print(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: {result.get('ok', False)}")
            
        else:
            # –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
            help_text = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥."
            url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
            data = {
                'chat_id': chat_id,
                'text': help_text
            }
            requests.post(url, json=data)
            print(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç–≤–µ—Ç –Ω–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—É—é –∫–æ–º–∞–Ω–¥—É")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("ü§ñ –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º")
    print("=" * 30)
    
    while True:
        try:
            process_updates()
            print("‚è±Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥...")
            time.sleep(5)
        except KeyboardInterrupt:
            print("\nüëã –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...")
            break
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            time.sleep(5)

if __name__ == "__main__":
    main()
